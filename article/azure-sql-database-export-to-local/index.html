<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.139.2"><meta name=viewport content="width=device-width,initial-scale=1"><title>Azure SQL Database Export to Localhost using SqlPackage &#183; by Alex Code blog</title>
<meta name=keywords content="azure,sql,database,backup,sqlpackage"><meta name=description content="How to create local backup of azure sql database."><link type=text/css rel=stylesheet href=https://byalexblog.net/css/print.css media=print><link type=text/css rel=stylesheet href=https://byalexblog.net/css/poole.css><link type=text/css rel=stylesheet href=https://byalexblog.net/css/syntax.css><link type=text/css rel=stylesheet href=https://byalexblog.net/css/hyde.css><link type=text/css rel=stylesheet href=https://byalexblog.net/css/vs_theme_style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class=container><div class=sidebar-about><a href=https://byalexblog.net/><h1>by Alex Code blog</h1></a><p class=lead>Smart thoughts... and not very smart too!</p></div><nav><ul class=sidebar-nav><li><a href=https://byalexblog.net/>Home</a></li><li><a href=https://byalexblog.net/article>Articles</a></li><li><a href=https://github.com/lanubisl target=_blank>Github</a></li><li><a href=https://www.linkedin.com/in/panfilenok target=_blank>LinkedIn</a></li></ul></nav><p>&copy; 2024. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Azure SQL Database Export to Localhost using SqlPackage</h1><time datetime=2024-09-12T06:53:27Z class=post-date>Thu, Sep 12, 2024</time><p><img src=/images/azure-sql-database-export-to-local/terminal.png alt></p><p>Exporting an Azure SQL Server database locally is a common task for developers and administrators who need to create backups, test changes, or migrate databases to other environments. If your SQL Server instance is configured with Entra ID (formerly Azure AD) authentication, you might face an issue connecting to the database with username and password from the command line tool like <a href="https://learn.microsoft.com/en-us/sql/tools/sqlpackage/sqlpackage?view=sql-server-ver16" target=_blank rel=noopener>SqlPackage</a>.</p><p>In this guide, Iâ€™ll walk you through the process of exporting an Azure SQL Server database to your local windows machine using Powershell, SqlPackage tool and Azure SQL Server with Entra ID authentication.</p><h2 id=prerequisites>Prerequisites</h2><p>Before we begin, ensure the following:</p><ul><li>SqlPackage <a href="https://learn.microsoft.com/en-us/sql/tools/sqlpackage/sqlpackage-download?view=sql-server-ver16" target=_blank rel=noopener>Installed</a>.</li><li>Entra ID Access: You must have the necessary permissions (like DBOwner or DBReader) to access the database using your Entra ID.</li><li>Azure SQL Database: Ensure the database you want to export is accessible.</li></ul><h2 id=export>Export</h2><p>To authenticate with your credentials including MFA use the syntax as shown in the last example of the <a href="https://learn.microsoft.com/en-us/sql/tools/sqlpackage/sqlpackage-export?view=sql-server-ver16#examples" target=_blank rel=noopener>documentation page</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>sqlpackage.exe `
</span></span><span style=display:flex><span>	/Action:Export `
</span></span><span style=display:flex><span>	/TargetFile:&#34;C:\Users\User\{BACKUP_FILE_NAME}.bacpac&#34; `
</span></span><span style=display:flex><span>    /UniversalAuthentication:True `
</span></span><span style=display:flex><span>	/SourceConnectionString:&#34;Server=tcp:{SQL_SERVER_NAME}.database.windows.net,1433;Initial Catalog={DATABASE_NAME};MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;&#34;
</span></span></code></pre></div><p>The important part here is <code>/UniversalAuthentication:True</code>. When set to True, the interactive authentication protocol is activated supporting Multi-Factor Authentication.</p><p>The commang will trigger browser window to open and ask you to authenticate:</p><p><img src=/images/azure-sql-database-export-to-local/signin.png alt></p><p>After the authentication the command will proceed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>Connecting to database &#39;db-mydatabase&#39; on server &#39;tcp:sql-myserver.database.windows.net,1433&#39;.
</span></span><span style=display:flex><span>Extracting schema
</span></span><span style=display:flex><span>Extracting schema from database
</span></span><span style=display:flex><span>Resolving references in schema model
</span></span><span style=display:flex><span>Validating schema model
</span></span><span style=display:flex><span>Validating schema model for data package
</span></span><span style=display:flex><span>Validating schema
</span></span><span style=display:flex><span>Exporting data from database
</span></span><span style=display:flex><span>Exporting data
</span></span><span style=display:flex><span>Processing Export.
</span></span><span style=display:flex><span>Processing Table &#39;[gde].[task]&#39;.
</span></span><span style=display:flex><span>Processing Table &#39;[gde].[comment]&#39;.
</span></span><span style=display:flex><span>Processing Table &#39;[gde].[tag]&#39;.
</span></span><span style=display:flex><span>Processing Table &#39;[gde].[user]&#39;.
</span></span><span style=display:flex><span>Successfully exported database and saved it to file &#39;C:\Users\User\my_database_backup.bacpac&#39;.
</span></span><span style=display:flex><span>Changes to connection setting default values were incorporated in a recent release.  More information is available at https://aka.ms/dacfx-connection
</span></span><span style=display:flex><span>Time elapsed 0:04:31.81
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Using SqlPackage with Entra ID authentication, you can easily export an Azure SQL Server database to your local environment. This method avoids the need for SQL Server authentication and leverages the security of Entra ID. With the right permissions and tools in place, exporting a database is straightforward and can be done with just a few command-line instructions.</p></div><h2>Comments</h2><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//byalexblog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main></body></html>