<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.153.2"><meta name=viewport content="width=device-width,initial-scale=1"><title>Azure Function (Python) Application Insights &#183; by Alex Code blog</title><meta name=keywords content="azure,azure function,python,logging,opentelemetry,application insights"><meta name=description content="How to configure Application Insights logging for Python Azure Function"><link type=text/css rel=stylesheet href=https://blog.byalex.dev/css/print.css media=print><link type=text/css rel=stylesheet href=https://blog.byalex.dev/css/poole.css><link type=text/css rel=stylesheet href=https://blog.byalex.dev/css/syntax.css><link type=text/css rel=stylesheet href=https://blog.byalex.dev/css/hyde.css><link type=text/css rel=stylesheet href=https://blog.byalex.dev/css/vs_theme_style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class=container><div class=sidebar-about><a href=https://blog.byalex.dev/><h1>by Alex Code blog</h1></a><p class=lead>Smart thoughts... and not very smart too!</p></div><nav><ul class=sidebar-nav><li><a href=https://blog.byalex.dev/>Home</a></li><li><a href=https://blog.byalex.dev/article>Articles</a></li><li><a href=https://github.com/lanubisl target=_blank>Github</a></li><li><a href=https://www.linkedin.com/in/panfilenok target=_blank>LinkedIn</a></li></ul></nav><p>&copy; 2025. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Azure Function (Python) Application Insights</h1><time datetime=2025-12-25T18:53:32Z class=post-date>Thu, Dec 25, 2025</time><p>This article explores configuring Application Insights for Python Azure Functions to achieve visual spans for individual function calls, enabling nested tracing for better insights into function behavior.</p><p><img src=/images/azure-function-python-application-insights/application-insights-spans.png alt></p><h3 id=step-1-use-the-correct-pip-package>Step 1: Use the Correct pip Package</h3><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-text data-lang=text><span style=display:flex><span># requirements.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>azure-functions==1.24.0
</span></span><span style=display:flex><span>azure-identity==1.25.1
</span></span><span style=display:flex><span>aiohttp==3.13.2
</span></span><span style=display:flex;background-color:#bcc0cc><span>azure-monitor-opentelemetry==1.8.3
</span></span><span style=display:flex><span>requests==2.32.5
</span></span><span style=display:flex><span>cryptography==46.0.3
</span></span></code></pre></div><p>As documented here: <a href="https://learn.microsoft.com/en-us/azure/azure-functions/opentelemetry-howto?tabs=app-insights%2Cihostapplicationbuilder%2Cmaven&amp;pivots=programming-language-python#enable-opentelemetry-in-your-app" target=_blank rel=noopener>Microsoft Learn | Use OpenTelemetry with Azure Functions | Enable OpenTelemetry in your app</a></p><blockquote><p>Do not enable OpenTelemetry in the Functions host as documented here: <a href="https://learn.microsoft.com/en-us/azure/azure-functions/opentelemetry-howto?tabs=app-insights%2Cihostapplicationbuilder%2Cmaven&amp;pivots=programming-language-python#enable-opentelemetry-in-the-functions-host" target=_blank rel=noopener>Microsoft Learn | Use OpenTelemetry with Azure Functions | Enable OpenTelemetry in the Functions host</a>, because it will enable OpenTelemetry at a low level and send unnecessary data to Application Insights. See <a href=https://github.com/Azure/azure-functions-dotnet-worker/issues/3270 target=_blank rel=noopener>GitHub issue | OpenTelemetry captures and spams with GET /admin/host/ping requests</a></p></blockquote><h3 id=step-2-configure-opentelemetry-in-function_apppy>Step 2: Configure OpenTelemetry in function_app.py</h3><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#179299>from</span> <span style=color:#fe640b>azure.monitor.opentelemetry</span> <span style=color:#179299>import</span> configure_azure_monitor
</span></span><span style=display:flex><span>configure_azure_monitor()
</span></span></code></pre></div><p>As documented here: <a href="https://learn.microsoft.com/en-us/azure/azure-functions/opentelemetry-howto?tabs=app-insights%2Cihostapplicationbuilder%2Cmaven&amp;pivots=programming-language-python#enable-opentelemetry-in-your-app" target=_blank rel=noopener>Microsoft Learn | Use OpenTelemetry with Azure Functions | Enable OpenTelemetry in your app</a></p><h3 id=step-3-transform-function-context-into-opentelemetry-context>Step 3: Transform Function Context into OpenTelemetry Context</h3><div class=highlight><pre tabindex=0 style=color:#4c4f69;background-color:#eff1f5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#179299>import</span> <span style=color:#fe640b>azure.functions</span> <span style=color:#8839ef>as</span> <span style=color:#fe640b>func</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#179299>from</span> <span style=color:#fe640b>azure.monitor.opentelemetry</span> <span style=color:#179299>import</span> configure_azure_monitor
</span></span><span style=display:flex><span><span style=color:#179299>from</span> <span style=color:#fe640b>opentelemetry</span> <span style=color:#179299>import</span> trace
</span></span><span style=display:flex><span><span style=color:#179299>from</span> <span style=color:#fe640b>opentelemetry.propagate</span> <span style=color:#179299>import</span> extract
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#9ca0b0;font-style:italic># Configure Azure monitor collection telemetry pipeline</span>
</span></span><span style=display:flex><span>configure_azure_monitor()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8839ef>def</span> <span style=color:#1e66f5>main</span>(req: func<span style=color:#04a5e5;font-weight:700>.</span>HttpRequest, context) <span style=color:#04a5e5;font-weight:700>-&gt;</span> func<span style=color:#04a5e5;font-weight:700>.</span>HttpResponse:
</span></span><span style=display:flex><span>   <span style=color:#04a5e5;font-weight:700>...</span>
</span></span><span style=display:flex><span>   <span style=color:#9ca0b0;font-style:italic># Store current TraceContext in dictionary format</span>
</span></span><span style=display:flex><span>   carrier <span style=color:#04a5e5;font-weight:700>=</span> {
</span></span><span style=display:flex><span>      <span style=color:#40a02b>&#34;traceparent&#34;</span>: context<span style=color:#04a5e5;font-weight:700>.</span>trace_context<span style=color:#04a5e5;font-weight:700>.</span>Traceparent,
</span></span><span style=display:flex><span>      <span style=color:#40a02b>&#34;tracestate&#34;</span>: context<span style=color:#04a5e5;font-weight:700>.</span>trace_context<span style=color:#04a5e5;font-weight:700>.</span>Tracestate,
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#9ca0b0;font-style:italic># Create tracer instance for trace correlations</span>
</span></span><span style=display:flex><span>   tracer <span style=color:#04a5e5;font-weight:700>=</span> trace<span style=color:#04a5e5;font-weight:700>.</span>get_tracer(<span style=color:#dc8a78>__name__</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#9ca0b0;font-style:italic># Start a span using the current context</span>
</span></span><span style=display:flex><span>   <span style=color:#8839ef>with</span> tracer<span style=color:#04a5e5;font-weight:700>.</span>start_as_current_span(
</span></span><span style=display:flex><span>      <span style=color:#40a02b>&#34;http_trigger_span&#34;</span>,
</span></span><span style=display:flex><span>      context<span style=color:#04a5e5;font-weight:700>=</span>extract(carrier),
</span></span><span style=display:flex><span>   ):
</span></span><span style=display:flex><span>      <span style=color:#04a5e5;font-weight:700>...</span>
</span></span></code></pre></div><p>This approach is documented here: <a href=https://github.com/Azure/azure-sdk-for-python/blob/main/sdk/monitor/azure-monitor-opentelemetry/README.md#trace-correlation target=_blank rel=noopener>GitHub | Azure | azure-sdk-for-python | azure-monitor-opentelemetry</a></p><h3 id=example-repository>Example Repository</h3><p><a href=https://github.com/lAnubisl/AzureFunctionPython target=_blank rel=noopener>https://github.com/lAnubisl/AzureFunctionPython</a></p><h3 id=additional-context-and-links>Additional Context and Links</h3><p>Note that there is no <a href=https://learn.microsoft.com/en-us/azure/azure-monitor/app/asp-net-dependencies#dependency-auto-collection target=_blank rel=noopener>automatic dependency and transaction diagnostic auto-collection</a>. Additionally, there are no samples demonstrating <a href=https://learn.microsoft.com/en-us/azure/azure-monitor/app/api-custom-events-metrics#trackdependency target=_blank rel=noopener>how to track dependencies manually</a> for Python Azure Functions. The <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-reference-python?tabs=get-started%2Casgi%2Capplication-level&amp;pivots=python-mode-decorators#log-custom-telemetry" target=_blank rel=noopener>Azure Functions Python Developer Reference Guide</a> describes how to log custom telemetry using the OpenCensus library. You can also find samples of how to use this library in <a href=https://learn.microsoft.com/en-us/azure/architecture/guide/devops/monitor-with-opencensus-application-insights target=_blank rel=noopener>Monitor a distributed system by using Application Insights and OpenCensus</a>. However, you should not use it because <a href="https://azure.microsoft.com/en-us/updates/python-opencensus-retirement/#:~:text=On%2030%20September%202024%2C%20we,a%20single%20line%2Dof%2Dcode" target=_blank rel=noopener>Azure Monitor support for OpenCensus will end on 30 September 2024 - transition to using Azure Monitor OpenTelemetry Python Distro</a>. Here is the guide for <a href=https://learn.microsoft.com/en-us/azure/azure-monitor/app/opentelemetry-python-opencensus-migrate target=_blank rel=noopener>Migrating from OpenCensus Python SDK and Azure Monitor OpenCensus exporter for Python to Azure Monitor OpenTelemetry Python Distro</a> and a step-by-step guide: <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/app/opentelemetry-enable?tabs=python#enable-opentelemetry-with-application-insights" target=_blank rel=noopener>Enable Azure Monitor OpenTelemetry for .NET, Node.js, Python, and Java applications</a></p></div><h2>Comments</h2><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//byalexblog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main></body></html>